<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>mini KID'S CLOTHES</title>

    <!-- Bootstrap CSS -->
    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
        crossorigin="anonymous"
    >

    <!-- Bootstrap Icons -->
    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css"
        rel="stylesheet"
    >

    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles.css">

    <script src="store.js"></script>
</head>

<body>

    <!-- HEADER -->
    <section id="header">
        <a href="#">
            <img src="logo5.png" class="logo" alt="" style="width: 200px">
        </a>

        <div>
            <ul id="navbar">
                <li><a href="store.html">Home</a></li>
                <li><a class="active" href="shop.html">Shop</a></li>

                <!-- Admin link-->
                
                <!-- Icons -->
                <li id="logIn">
                    <a href="logIn.html"><i class="bi bi-person-fill"></i></a>
                </li>
                <li>
                    <a href="cart.html"><i class="bi bi-bag"></i></a>
                </li>
            </ul>

            <!-- TOP BUTTONS -->
            <div class="add-product-container">

                <!--  Sort button – -->
                <button id="sort-price-asc" class="top-admin-btn">
                    Sort by Price ↑
                </button>

                <!--  Admin buttons  -->
                <button id="admin-stats-btn" class="top-admin-btn" style="display: none;">
                    System Statistics
                </button>

                <button id="add-product-btn" class="top-admin-btn" style="display: none;">
                    Add Product
                    <button id="sort-alpha" class="top-admin-btn">Sort A → Z</button>
                </button>
            </div>
        </div>
    </section>

    <!-- PAGE HEADER -->
    <section id="pageHeader">
        <p id="welcomeMessage">Welcome!</p>
        <h2>Why Choose "Mini"?</h2>
        <p>Express your unique style while protecting the environment with Mini.</p>
    </section>

    <!-- PRODUCTS SECTION -->
    <section id="product1" class="container content-section">

    <!--  Currency Toggle Button  -->
    <button id="toggle-currency-btn" class="btn btn-secondary" style="margin-bottom: 20px;">
        Show in ₪
    </button>

    <p id="weather-info" style="font-size: 20px; margin-bottom: 15px; font-weight: bold;">
    Loading weather...
</p>


    <div id="shop-items" class="shop-items"></div>
</section>


    <!-- NEWSLETTER -->
    <section id="newsletter" class="section-p1 section-m1">
        <div class="newstext">
            <h4>Sign Up For Newsletters <i class="bi bi-stars"></i></h4>
            <p>Get E-mail updates about our latest shop and <span>special offers.</span></p>
        </div>
        <div class="form">
            <input type="text" id="new" placeholder="Your email address">
            <button onclick="thankyou();" class="normal">Sign Up</button>
        </div>
    </section>

    <!-- JS FILES -->
    <script src="auth-client.js"></script>
    <script src="shop.js"></script>

    <script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous">
    </script>

    <!-- ADD PRODUCT MODAL -->
    <div id="addProductModal" class="modal-overlay">
        <div class="modal-box">
            <h2>Add New Product</h2>

            <form id="add-product-form">
                <input type="text" id="p-title" placeholder="Title" required>
                <input type="number" id="p-price" placeholder="Price" required>
                <input type="text" id="p-image" placeholder="Image URL" required>
                <input type="number" id="p-stock" placeholder="Stock" required>
                <textarea id="p-desc" placeholder="Description"></textarea>

                <button type="submit" class="save-btn">Save Product</button>
            </form>

            <button type="button" id="closeModal" class="close-btn">Cancel</button>
        </div>
    </div>

    <!-- EDIT PRODUCT MODAL -->
    <div id="editProductModal" class="modal-overlay">
        <div class="modal-box">
            <h2>Edit Product</h2>

            <form id="edit-product-form">
                <input type="text" id="edit-title" placeholder="Title" required>
                <input type="number" id="edit-price" placeholder="Price" required>
                <input type="text" id="edit-image" placeholder="Image URL" required>
                <input type="number" id="edit-stock" placeholder="Stock" required>
                <textarea id="edit-desc" placeholder="Description"></textarea>

                <button type="submit" class="save-btn">Save Changes</button>
            </form>

            <button type="button" id="closeEditModal" class="close-btn">Cancel</button>
        </div>
    </div>

    <!-- SHOW ADMIN ELEMENTS -->
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const token = localStorage.getItem("token");
            if (!token) return;

            try {
                const payload = JSON.parse(atob(token.split(".")[1]));

                if (payload.role === "admin") {
                    // Show Add Product button
                    const addProductBtn = document.getElementById("add-product-btn");
                    if (addProductBtn) addProductBtn.style.display = "inline-block";

                    // Show System Statistics button
                    const statsBtn = document.getElementById("admin-stats-btn");
                    if (statsBtn) {
                        statsBtn.style.display = "inline-block";
                        statsBtn.addEventListener("click", () => {
                            window.location.href = "stats.html";
                        });
                    }
                }
            } catch (err) {
                console.error("Invalid token", err);
            }
        });
    </script>

</body>
</html>
